<html>
<head>
  <title>A Leaflet map!</title>
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"/>
  <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>

  <script src="//d3js.org/topojson.v1.min.js"></script>

  <script type = "text/javascript" src= "d3/d3.min.js"></script>

  <script type = "text/javascript" src= "d3/d3.js"></script>
  <script type = "text/javascript" src = "d3-timeline/src/d3-timeline.js"></script>
  <script src="http://d3js.org/queue.v1.min.js"></script>

  <link rel="stylesheet" href= "timeline.css"/>

  
  <script type = "text/javascript">
  window.onload=function(){
    var data; // a global
    d3.json("dataProcessing/timeline1.json", function(error, json) {
      if (error) return console.warn(error);
      data = json;
      timelineHover(data);
  });

    var width = 800;
    var height = 60;

    function timelineHover(data) {
    
    var year = d3.time.format("%Y");
    var chart = d3.timeline()
      .width(width)         // Set timeline width
      .height(height)       // Set timeline height
      .beginning(-3471238780000)  // Set starting date for timeline
      .ending(80000000000)      // Set ending date for timeline
      .margin({left:70, right:30, top:0, bottom:0}) // Set margins
      .display("circle")      // Display points as circles
      .itemHeight(10)       // Set the diameter of the circles to 10px
      .hover(function (d, i, datum) { // Define what happens on hover
      
          // Removed unnecessary jQuery calls, replaced with D3 equivalent
        var div = d3.select('#description');  // Select the 'description' div
        div.select('.coloredDiv')       // Inside that, select the '.coloredDiv' element
          .style('background-color', d.color) //   and set its color to match the datapoint
          
        div.select('#name')   // Then select the 'name' div, and fill it with some text
          .text(year(new Date(d.starting_time)) + ": " + d.description);
        })
      .tickFormat({         // Set the formatting for the tickmarks:
      format: d3.time.format("%Y"),   // Select only the year portion of the date
      tickTime: d3.time.year,     // Display ticks in 1 year increments
      tickInterval: 5,        // Only display every 5th year
      tickSize: 5 });         // Draw 5px hashmarks at each tick
        
    // Build the timeline    
  var svg = d3.select("#timeline")
    .append("svg")
    .attr("width", width)
    .datum(data)
    .call(chart);

  // Rotate tick labels 90 degrees to improve legibility
  svg.selectAll(".tick").selectAll("text")
    .attr("y", 0)
      .attr("x", -20)
      .attr("dy", ".35em")
    .attr("transform", "rotate(-90)")
      .style("text-anchor", "right");
    }
  }
  </script>
</head>
<body>
  <div>
      <div id="map"></div>
  <script>
 
var width = 960,
    height = 500;

var path = d3.geo.path();

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

d3.json("us.json", function(error, topology) {
  if (error) throw error;

  svg.selectAll("path")
      .data(topojson.feature(topology, topology.objects.counties).features)
    .enter().append("path")
      .attr("d", path);
});

  </script>
  <div>
    <div id="timeline"></div>
    <div id="description">
      <div class="coloredDiv"></div>
      <div id="name"></div>
    </div>
  </div>
</body>
</html>
