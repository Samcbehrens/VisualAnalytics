<html>
<head>
  <title>A Leaflet map!</title>
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"/>
  <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>

  <script type = "text/javascript" src= "d3/d3.min.js"></script>
  <script type = "text/javascript" src= "d3/d3.js"></script>
  <script type = "text/javascript" src = "d3-timeline/src/d3-timeline.js"></script>
  <style>
  #map{ width: 900px; height: 500px; }
  </style>

  <script type = "text/javascript">
  window.onload=function(){
    var data; // a global
    d3.json("dataProcessing/timeline3.json", function(error, json) {
      if (error) return console.warn(error);
      data = json;
      console.log('you got some data');

      var test = [
      {label: "timeline3", 
      times: [
      {
        "color": "green", 
        "ending_time": 1864, 
        "label": ":Emancipation Proclamation ends slavery in the South.", 
        "starting_time": 1863
      }, 
      {
        "color": "yellow", 
        "ending_time": 1866, 
        "label": "13th Amendment officially abolishes slavery.Juneteenth Freedom Celebration in Texas and Oklahoma.", 
        "starting_time": 1865
      }, 
      {
        "color": "green", 
        "ending_time": 1867, 
        "label": "Ex", 
        "starting_time": 1866
      }
      ]
    }
    ];

    timelineHover(data);
  });

    var width = 1000;

    function timelineHover(data) {
      console.log('got some data in some functions' , data);
      var chart = d3.timeline()
      .width(width)
      .stack()
          .beginning(-2524520000000)
          .ending(80000000)
      .display("circle")
      .margin({left:70, right:30, top:0, bottom:0})
      .hover(function (d, i, datum) {
            // d is the current rendering object
            // i is the index during d3 rendering
            // datum is the id object
            var div = $('#hoverRes');
            var colors = chart.colors();
            div.find('.coloredDiv').css('background-color', colors(i))
            div.find('#name').text(datum.label);
          })
      .tickFormat({
        format: d3.time.format("%Y"), 
        tickTime: d3.time.year,
        tickInterval: 6, 
        tickSize: 6 })
      .click(function (d, i, datum) {
       alert(datum.label);
     })
      .scroll(function (x, scale) {
       $("#scrolled_date").text(scale.invert(x) + " to " + scale.invert(x+width));
     });
      var svg = d3.select("#timeline3").append("svg").attr("width", width)
      .datum(data).call(chart);
    }
  }
  </script>
</head>
<body>
  <div id="map"></div>
  <script>
  // initialize the map
  var map = L.map('map').setView([42.35, -71.08], 13);

  // load a tile layer
  L.tileLayer('http://tiles.mapc.org/basemap/{z}/{x}/{y}.png',
  {
    attribution: 'Tiles by <a href="http://mapc.org">MAPC</a>, Data by <a href="http://mass.gov/mgis">MassGIS</a>',
    maxZoom: 17,
    minZoom: 9
  }).addTo(map);
  </script>
  <div>
    <h3>A stacked timeline with hover, click, and scroll events</h3>
    <div id="timeline3"></div>
    <div id="hoverRes">
      <div class="coloredDiv"></div>
      <div id="name"></div>
      <div id="scrolled_date"></div>
    </div>
  </div>
</body>
</html>